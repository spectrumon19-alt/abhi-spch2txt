<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Meeting Scribe - Infinite Mode</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0f172a; color: #f8fafc; margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; padding: 20px; }
        .container { width: 100%; max-width: 900px; background: #1e293b; border-radius: 16px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 1px solid #334155; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #334155; padding-bottom: 15px; }
        #output { background: #020617; border-radius: 12px; padding: 20px; height: 500px; overflow-y: auto; font-size: 1.2rem; line-height: 1.8; border: 1px solid #1e293b; margin-bottom: 20px; white-space: pre-wrap; }
        .timestamp { color: #6366f1; font-weight: bold; font-family: monospace; font-size: 0.9rem; margin-right: 10px; }
        .interim { color: #64748b; font-style: italic; }
        .controls { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; }
        button { padding: 12px 25px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; font-size: 1rem; }
        .btn-start { background: #10b981; color: white; }
        .btn-stop { background: #ef4444; color: white; }
        .btn-copy { background: #6366f1; color: white; }
        button:disabled { opacity: 0.3; cursor: not-allowed; }
        .status-dot { width: 10px; height: 10px; background: #94a3b8; border-radius: 50%; display: inline-block; margin-right: 8px; }
        .recording .status-dot { background: #ef4444; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2 style="margin:0;">Abhi Meeting Scribe v2 </h2> <h2><a href="index.html" style="color: white; float: right;">Meeting notes v1 </a>
</h2> <h2><a href="speechtotext.html" style="color: white; float: right;"> Meeting notes pro </a>
</h2>
        <div id="status-container"><span class="status-dot"></span><span id="status-text">Ready</span></div>
    </div>

    <div id="output">Developed by Abhishek Shankar, Welcome. Click 'Start Meeting' and grant microphone access. Once granted, this app will listen infinitely until you press Stop.</div>

    <div class="controls">
        <button id="startBtn" class="btn-start">Start Meeting</button>
        <button id="stopBtn" class="btn-stop" disabled>Stop & Save</button>
        <button id="copyBtn" class="btn-copy">Copy Text</button>
    </div>
    	 <div>
	<footer style="text-align: center; padding:1px; background-color: #334155; margin-top: 1px;">
    <p>Developed by Abhishek</p>
</footer>
</div>
</div>

<script>
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const copyBtn = document.getElementById('copyBtn');
    const output = document.getElementById('output');
    const statusText = document.getElementById('status-text');
    const statusContainer = document.getElementById('status-container');

    let recognition;
    let isActive = false;
    let finalTranscript = "";

    // Initialize Recognition
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    
    if (!SpeechRecognition) {
        output.innerHTML = "âŒ Error: Your browser does not support Speech Recognition. Please use Chrome or Edge.";
    } else {
        recognition = new SpeechRecognition();
        recognition.continuous = true;
        recognition.interimResults = true;
        recognition.lang = 'en-US';

        recognition.onresult = (event) => {
            let interimTranscript = "";
            for (let i = event.resultIndex; i < event.results.length; ++i) {
                const transcript = event.results[i][0].transcript;
                if (event.results[i].isFinal) {
                    const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'});
                    // Basic Punctuation
                    let sentence = transcript.trim();
                    sentence = sentence.charAt(0).toUpperCase() + sentence.slice(1);
                    if (!/[.!?]$/.test(sentence)) sentence += ".";
                    
                    finalTranscript += `[${time}] ${sentence}\n`;
                } else {
                    interimTranscript += transcript;
                }
            }
            output.innerHTML = `<div>${finalTranscript.replace(/\n/g, '<br>')}</div><span class="interim">${interimTranscript}</span>`;
            output.scrollTop = output.scrollHeight;
        };

        // THE INFINITE LOOP: Auto-restart on end
        recognition.onend = () => {
            if (isActive) {
                console.log("Restarting recognition...");
                recognition.start();
            }
        };

        recognition.onerror = (event) => {
            console.error("Speech Error:", event.error);
            if (event.error === 'not-allowed') {
                alert("Permission denied. Click the lock icon in the address bar and allow the Microphone.");
            }
        };
    }

    startBtn.onclick = async () => {
        try {
            // STEP 1: Warm up the mic to lock in permission
            await navigator.mediaDevices.getUserMedia({ audio: true });
            
            // STEP 2: Start the logic
            isActive = true;
            finalTranscript = "";
            output.innerHTML = "";
            recognition.start();
            
            startBtn.disabled = true;
            stopBtn.disabled = false;
            statusContainer.className = "recording";
            statusText.innerText = "Listening...";
        } catch (err) {
            alert("Microphone access is required. Please enable it in browser settings.");
        }
    };

    stopBtn.onclick = () => {
        isActive = false;
        recognition.stop();
        startBtn.disabled = false;
        stopBtn.disabled = true;
        statusContainer.className = "";
        statusText.innerText = "Stopped";
        
        // Auto-download result
        const blob = new Blob([finalTranscript], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `Meeting_Notes_${new Date().toLocaleDateString()}.txt`;
        a.click();
    };

    copyBtn.onclick = () => {
        navigator.clipboard.writeText(finalTranscript);
        alert("Transcript copied to clipboard!");
    };
</script>
</body>

</html>




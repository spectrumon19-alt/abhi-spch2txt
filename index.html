<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abhi spch2txt</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f172a; color: #f8fafc; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; }
        .app-card { width: 90%; max-width: 850px; background: #1e293b; padding: 2rem; border-radius: 24px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); border: 1px solid #334155; }
        #display-area { background: #020617; border-radius: 16px; padding: 25px; height: 450px; overflow-y: auto; font-size: 1.3rem; line-height: 1.7; border: 1px solid #1e293b; margin: 20px 0; scroll-behavior: smooth; }
        .interim { color: #64748b; font-style: italic; }
        .controls { display: flex; gap: 15px; justify-content: center; }
        button { padding: 16px 40px; font-size: 1.1rem; border-radius: 12px; border: none; font-weight: 800; cursor: pointer; transition: 0.2s; }
        .btn-start { background: #22c55e; color: white; }
        .btn-stop { background: #ef4444; color: white; }
        button:disabled { opacity: 0.3; cursor: not-allowed; }
        .live-indicator { display: inline-block; width: 10px; height: 10px; background: #ef4444; border-radius: 50%; margin-right: 10px; animation: blink 1s infinite; display: none; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.2; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div class="app-card">
     <h2><a href="ae.html" style="color: white;"> English.G</a>
<h2 style="margin:0; text-align: right;"> Abhi speech2text </h2> <h2><a href="speechtotext.html" style="color: white;"> Meeting notes v2</a>
</h2>

    <div id="display-area">Developed by Abhishek Shankar ... Waiting for you to start...</div>
    <div class="controls">
        <button id="startBtn" class="btn-start">Start speach to text</button>
        <button id="stopBtn" class="btn-stop" disabled>Stop</button>
    </div>
    <p id="statusInfo" style="text-align:center; color: #64748b; font-size: 0.9rem;">Mode: Standby</p>
</div>

<script>
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const display = document.getElementById('display-area');
    const statusInfo = document.getElementById('statusInfo');
    const dot = document.getElementById('dot');

    let isRecording = false;
    let finalText = "";
    
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();

    recognition.continuous = true;
    recognition.interimResults = true;
    recognition.lang = 'en-US';

    // 1. Process Results
    recognition.onresult = (event) => {
        let interimText = "";
        for (let i = event.resultIndex; i < event.results.length; ++i) {
            if (event.results[i].isFinal) {
                finalText += event.results[i][0].transcript + " ";
            } else {
                interimText += event.results[i][0].transcript;
            }
        }
        display.innerHTML = `<span>${finalText}</span><span class="interim">${interimText}</span>`;
        display.scrollTop = display.scrollHeight;
    };

    // 2. THE SECRET SAUCE: The Auto-Restarter
    recognition.onend = () => {
        if (isRecording) {
            console.log("Detecting accidental stop... restarting now.");
            recognition.start(); // Force restart immediately
        }
    };

    // 3. Heartbeat Check (Every 2 seconds, ensure it hasn't crashed)
    setInterval(() => {
        if (isRecording) {
            try {
                recognition.start(); 
            } catch (e) {
                // Throws error if already running, which is good! 
                // It means it's still alive.
            }
        }
    }, 2000);

    startBtn.onclick = () => {
        isRecording = true;
        finalText = "";
        display.innerHTML = "";
        recognition.start();
        
        startBtn.disabled = true;
        stopBtn.disabled = false;
        dot.style.display = "inline-block";
        statusInfo.innerText = "Mode: ALWAYS RUNNING (Listening...)";
    };

    stopBtn.onclick = () => {
        isRecording = false;
        recognition.stop();
        startBtn.disabled = false;
        stopBtn.disabled = true;
        dot.style.display = "none";
        statusInfo.innerText = "Mode: Stopped";
    };

    recognition.onerror = (err) => {
        console.error("Speech Error:", err.error);
        if (err.error === 'no-speech' && isRecording) {
            // Keep going even if no one is talking
        }
    };
</script>
</body>

</html>

